---
title:  "λ΅λ“λ°Έλ°μ‹±μ΄λ€ (loadbalancing)"
layout: single
categories: 
  - network

tags:
  - [CS, network]

toc: true
toc_sticky: true

date: 2022-03-18
last_modified_at: 2022-03-18
---
# Load Balancing

# λ΅λ“λ°Έλ°μ‹±μ΄λ€?

λ΅λ“ λ°Έλ°μ‹±μ€ λ„¤νΈμ›ν¬ λλ” μ„λ²„μ— κ°€ν•΄μ§€λ” λ¶€ν•(=λ΅λ“) λ¥Ό λ¶„μ‚°(=λ²¨λ°μ‹±)ν•΄μ£Όλ” κΈ°μ μ„ μλ―Έν•λ‹¤. λ΅λ“λ°Έλ°μ‹± κΈ°μ μ„ μ κ³µν•λ” μ„λΉ„μ¤ λλ” μ¥μΉ(λ΅λ“λ°Έλ°μ„)λ” ν΄λΌμ΄μ–ΈνΈμ™€ λ„¤νΈμ›ν¬ νΈλν”½μ΄ μ§‘μ¤‘λλ” μ„λ²„λ“¤ λλ” λ„¤νΈμ›ν¬ ν—λΈ μ‚¬μ΄μ— μ„μΉν•λ‹¤.

νΉμ • μ„λ²„ λλ” λ„¤νΈμ›ν¬ ν—λΈμ— λ¶€ν•κ°€ μ§‘μ¤‘λμ§€ μ•λ„λ΅ νΈλν”½μ„ λ‹¤μ–‘ν• λ°©λ²•μΌλ΅ λ¶„μ‚°ν•μ—¬ μ„λ²„λ‚ λ„¤νΈμ›ν¬ ν—λΈλ“¤μ μ„±λ¥μ„ μµμ μΈ μƒνƒλ΅ μ μ§€ν•  μ μλ„λ΅ ν•λ‹¤.

# λ΅λ“λ°Έλ°μ„μ κΈ°λ³Έ λ™μ‘ λ°©μ‹

1. ν΄λΌμ΄μ–ΈνΈμ λΈλΌμ°μ €μ—μ„ naver.comμ„ μ”μ²­
2. ν΄λΌμ΄μ–ΈνΈ λΈλΌμ°μ €μ— μ„¤μ •λ λ©”μΈ DNS μ„λ²„λ΅ naver.comμ IP μ£Όμ†λ¥Ό μ§μ(DNS query)
3. λ©”μΈ DNS μ„λ²„λ” [naver.com](http://naver.com) μ£Όμ†λ¥Ό κ΄€λ¦¬ν•λ” λ³„λ„μ DNS μ„λ²„μ— IP μ£Όμ† query
4. λ³„λ„ κ΄€λ¦¬ DNS μ„λ²„λ” naver.comμ λ΅λ“λ°Έλ°μ„μ IP(Virtual IP) μ£Όμ†λ¥Ό λ©”μΈ DNS μ„λ²„μ—κ² μ „λ‹¬.
5. λ©”μΈ DNS μ„λ²„λ” νλ“ν• VIP μ£Όμ†λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ „μ†΅(DNS Response)
6. ν΄λΌμ΄μ–ΈνΈμ—μ„ λ΅λ“λ°Έλ°μ„μ VIP μ£Όμ†λ΅ http μ”μ²­
7. λ΅λ“ λ°Έλ°μ„λ” λ³„λ„ λ΅λ“λ°Έλ°μ‹± λ°©λ²•( λΌμ΄λ“ λ΅λΉ λ“±) μ„ ν†µν•μ—¬ μ„λ²„μ—κ² μ”μ²­μ„ μ „μ†΅
8. μ„λ²„μ μ‘μ—… κ²°κ³Όλ¥Ό λ°›μ€ λ΅λ“λ°Έλ°μ„λ” μ „λ‹¬λ°›μ€ http κ²°κ³Όλ¥Ό ν΄λΌμ΄μ–΄μ–ΈνΈμ—κ² μ „μ†΅

# λ΅λ“λ°Έλ°μ„μ κΈ°λ³Έ κΈ°λ¥

1. Health Check

κΈ°λ³Έμ μΌλ΅ λ³΄ν†µμ λ΅λ“λ°Έλ°μ„λ” μ„λ²„λ“¤(λλ” λ‹¤μμ λ…Έλ“) μ— λ€ν• μ£ΌκΈ°μ μΈ Health Checkλ¥Ό ν†µν•΄ μ„λ²„λ“¤μ μ¥μ•  μ—¬λ¶€λ¥Ό νλ‹¨ν•  μ μλ‹¤. μ΄λ΅ μΈν•΄ λ΅λ“λ°Έλ°μ„κ°€ μμ„ λ• μ„λ²„ λ‡ λ€μ— μ΄μƒμ΄ μƒκΈ°λ”λΌλ„ λ‹¤λ¥Έ μ •μƒ λ™μ‘μ¤‘μΈ μ„λ²„λ΅ νΈλν”½μ„ λ³΄λ‚΄μ£Όλ” Fail-Over κ°€ κ°€λ¥ν•λ©°, λ”λ¶μ–΄ TCP/UDP λ¶„μ„μ΄ κ°€λ¥ν•κΈ° λ•λ¬Έμ— Firewallμ μ—­ν• λ„ μν–‰ν•  μ μλ‹¤.

- L3 check : ICMPλ¥Ό μ΄μ©ν•μ—¬ μ„λ²„μ IP μ£Όμ†κ°€ ν†µμ‹  κ°€λ¥ν• μƒνƒμΈμ§€λ¥Ό ν™•μΈν•λ‹¤.
- L4 check : TCPμ 3-way handshaking μ„ μ΄μ©ν•μ—¬ κ° ν¬νΈ μƒνƒλ¥Ό μ²΄ν¬ν•λ‹¤. μλ¥Ό λ“¤μ–΄ HTTP μ›Ή μ„λ²„μ κ²½μ° 80ν¬νΈλ¥Ό μ‚¬μ©ν•λ―€λ΅ TCP 80 ν¬νΈμ— λ€ν• 3-wat hanshake μ²΄ν¬λ¥Ό ν†µν•΄ μ„λ²„κ°€ μ‚΄μ•„μλ” μƒνƒμΈμ§€λ¥Ό ν™•μΈν•λ‹¤.
- L7 μ²΄ν¬ : μ–΄ν”λ¦¬μΌ€μ΄μ… κ³„μΈµμ—μ„ μ²΄ν¬λ¥Ό ν•λ‹¤. μ¦‰ μ‹¤μ  μ›Ή νμ΄μ§€(ex .../index.html)μ— ν†µμ‹ μ„ μ‹λ„ν•μ—¬ μ΄μƒ μ λ¬΄λ¥Ό νμ•…ν•λ‹¤.

1. Tunneling

λμ— λ³΄μ΄μ§€ μ•λ” κ°€μƒμ ν†µλ΅λ¥Ό λ§λ“¤μ–΄ ν†µμ‹ ν•  μ μκ² ν•λ” κ°λ…μΌλ΅ λ΅λ“λ°Έλ°μ„λ” ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„ μ¤‘κ°„μ—μ„ ν„°λ„λ§μ„ μ κ³µν•΄μ¤€λ‹¤. μ¦‰ μ—°κ²°λ μƒνΈκ°„μ—λ§ μΊ΅μν™”λ ν¨ν‚·μ„ κµ¬λ³„ν•΄ μΊ΅μν™”λ¥Ό ν•΄μ ν•κ² ν•λ‹¤.

1. NAT(Network Address Translation)

IP μ£Όμ†λ¥Ό λ³€ν™ν•΄μ£Όλ” κΈ°λ¥μ΄λ‹¤. ν•λ‚μ κ³µμΈ IPλ΅ μ—¬λ¬ κ°μ μ‚¬μ„¤ IP κ³µκ°„μ„ μ€λ‹‰ν•λ” IP masquerading κΈ°λ²•μ„ μ‚¬μ©ν•λ‹¤. λ‹¤μμ ν†µμ‹ κΈ°κΈ°κ°€ ν•λ‚μ κ³µμΈ IPλ¥Ό μ‚¬μ©ν•μ—¬ μ™Έλ¶€ μΈν„°λ„·μ„ μ‚¬μ©ν•λ” κ²ƒμ„ κ°€λ¥ν•κ² ν•΄μ¤€λ‹¤.

λ΅λ“λ°Έλ°μ‹± κ΄€μ μ—μ„λ” μ—¬λ¬κ°μ νΈμ¤νΈκ°€ ν•λ‚μ κ³µμΈ IP μ£Όμ†λ¥Ό ν†µν•΄ μ ‘μ†ν•κ² ν•λ” κ²ƒμ΄ μ£Ό λ©μ μ΄λ‹¤.

- SNAT( Source Network Address Translation)
    
    λ‚΄λ¶€μ—μ„ μ™Έλ¶€λ΅ νΈλν”½μ΄ λ‚κ°€λ” κ²½μ°, λ‚΄λ¶€ μ‚¬μ„¤ IP μ£Όμ†λ¥Ό μ™Έλ¶€μ κ³µμΈ IP μ£Όμ†λ΅ λ³€ν™ν•λ” λ°©μ‹μ΄λ‹¤. μ§‘μ—μ„ μ‚¬μ©ν•λ” κ³µμ κΈ°κ°€ λ€ν‘μ μΈ μμ΄λ‹¤.
    
- DNAT( Destination Network Address Translation)
    
    μ™Έλ¶€μ—μ„ λ‚΄λ¶€λ΅ νΈλν”½μ΄ λ“¤μ–΄μ¤λ” κ²½μ°, μ™Έλ¶€ κ³µμΈ IP μ£Όμ†λ¥Ό λ‚΄λ¶€μ μ‚¬μ„¤ IP μ£Όμ†λ΅ λ³€ν™ν•λ” λ°©μ‹μ΄λ‹¤. λ΅λ“λ°Έλ°μ„κ°€ λ€ν‘μ μΈ μμ΄λ‹¤.
    
1. DSR( Direct Server Routing)

μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ λλμ•„κ°€λ” κ²½μ°, λ©μ μ§€λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ μ„¤μ •ν• λ‹¤μ λ„¤νΈμ›ν¬ μ¥λΉ„λ‚ λ΅λ“λ°Έλ°μ„λ¥Ό κ±°μΉμ§€ μ•κ³  λ°”λ΅ ν΄λΌμ΄μ–ΈνΈλ¥Ό μ°Ύμ•„κ°€λ” λ°©μ‹μ΄λ‹¤ μ΄ κ²½μ°, λ΅λ“λ°Έλ°μ„μ λ¶€ν•λ¥Ό μ¤„μ—¬μ¤„ μ μλ” μ¥μ μ΄ μλ‹¤.

<br>

<img width="686" alt="image" src="https://user-images.githubusercontent.com/61482670/158862698-1244b49f-9b01-440d-8775-4c659d7bdce7.png">

<br>

# λ΅λ“λ°Έλ°μ‹± μΆ…λ¥μ™€ λ°©λ²•(L4, L7κ³„μΈµ)

1. L4 λ΅λ“λ°Έλ°μ‹±

L4 λ΅λ“ λ°Έλ°μ„λ” λ„¤νΈμ›ν¬ κ³„μΈµ(IP) κ³Ό νΈλμ¤ν¬νΈ κ³„μΈµ(TCP,UDP) μ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ λ΅λ“λ¥Ό λ¶„μ‚°ν•λ‹¤,

μ¦‰ IP μ£Όμ†λ‚ ν¬νΈλ²νΈ MAC μ£Όμ†, μ „μ†΅ ν”„λ΅ν† μ½ λ“±μ— λ”°λΌ νΈλν”½μ„ λ‚λ„κ³  λ¶„μ‚°μ²λ¦¬ν•λ” κ²ƒμ΄ κ°€λ¥ν•λ‹¤. μ΄λ° μ΄μ λ΅ L4 λ΅λ“λ°Έλ°μ„λ¥Ό CLB(Connection Load Balancer) νΉμ€  SLB(Session Load Balancer)λΌκ³  λ¶€λ¥΄κΈ°λ„ ν•λ‹¤. 

L4 λ΅λ“λ°Έλ°μ‹±μ—λ” λ‹¤μκ³Ό κ°™μ€ λ°©λ²•λ“¤μ΄ μλ‹¤.

- λΌμ΄λ“ λ΅λΉ(Round Robin) : μ„Έμ…μ„ κ° μ„λ²„μ— μμ°¨μ μΌλ΅ λ§Ίμ–΄μ£Όλ” λ°©μ‹. λ‹¨μν μμ„μ— λ”°λΌ μ„Έμ…μ„ ν• λ‹Ήν•λ―€λ΅ κ²½μ°μ— λ”°λΌ κ²½λ΅λ³„ κ· λ“±ν• μ²λ¦¬λ‰μ„ λ³΄μ¥ν•  μ μ—†λ‹¤.
- κ°€μ¤‘μΉ λ° λΉ„μ¨ ν• λ‹Ή λ°©μ‹ : μ„λ²„λ§λ‹¤ λΉ„μ¨μ„ μ„¤μ •ν•΄ λ‘κ³  ν•΄λ‹Ή λΉ„μ¨ λ§νΌ μ„Έμ…μ„ λ§Ίμ–΄μ£Όλ” λ°©μ‹. μλ¥Ό λ“¤μ–΄ νΉμ • μ„λ²„μ μ„±λ¥μ΄ μ›”λ“±ν λ›°μ–΄λ‚λ‹¤λ©΄ ν•΄λ‹Ή μ„λ²„λ΅ μ„Έμ…μ„ λ§μ΄ λ§Ίμ–΄μ£Όλ„λ΅ κ°€μ¤‘μΉλ¥Ό μ„¤μ •ν•κ³  λ‚λ¨Έμ§€ λ΅μ°κΈ‰λ“¤μ μ„λ²„λ“¤μ€ μ μ€ μ„Έμ…μ΄ λ§Ίμ–΄μ§ μ μλ„λ΅ κ°€μ¤‘μΉλ¥Ό μ„¤μ •ν•λ‹¤.
- μµμ†μ—°κ²°(Least Connection)κΈ°λ° : κ°€μ¥ μ μ€ μ„Έμ…μ„ κ°€μ§„ μ„λ²„λ΅ νΈλν”½μ„ λ³΄λ‚΄λ” λ°©μ‹μ΄λ‹¤.(κ°€μ¥ λ§μ΄ μ‚¬μ©λλ” λ°©λ²•)
- μ‘λ‹µ μ‹κ°„ κΈ°λ°: κ°€μ¥ λΉ λ¥Έ μ‘λ‹µ μ‹κ°„μ„ λ³΄λ‚΄λ” μ„λ²„λ΅ νΈλν”½μ„ λ°Έλ°μ‹±ν•΄μ£Όλ” λ°©μ‹μ΄λ‹¤. μλ¥Ό λ“¤μ–΄ κ° μ„λ²„λ“¤μ κ°€μ©ν• λ¦¬μ†μ¤μ™€ μ„±λ¥, κ·Έλ¦¬κ³  μ²λ¦¬μ¤‘μΈ λ°μ΄ν„° μ–‘ λ“±μ΄ λ‹¤λ¥Ό κ²½μ° μ ν•©ν• λ°©μ‹μ΄λ‹¤.
- ν•΄μ‹ κΈ°λ°: νΉμ • ν΄λΌμ΄μ–ΈνΈλ” νΉμ • μ„λ²„λ΅λ§ ν• λ‹Ήμ‹ν‚¤λ” λ°©μ‹μ΄λ‹¤. μλ¥Ό λ“¤μ–΄, νΉμ • IP μ£Όμ† νΉμ€ ν¬νΈμ ν΄λΌμ΄μ–ΈνΈλ“¤μ€ νΉμ • μ„λ²„λ΅λ§ μ„Έμ…μ΄ λ§Ίμ–΄μ§€λ„λ΅ ν•λ‹¤. κ²½λ΅κ°€ λ³΄μ¥λλ©° μ ‘μ†μ μκ°€ λ§μ„μλ΅ λ¶„μ‚° λ° ν¨μ¨μ΄ λ›°μ–΄λ‚λ‹¤.
- λ€μ—­ν­ κΈ°λ°: μ„λ²„λ“¤κ³Όμ λ€μ—­ν­μ„ κ³ λ ¤ν•μ—¬ νΈλν”½μ„ λ¶„μ‚°ν•λ” λ°©μ‹μ΄λ‹¤.

1. L7 λ΅λ“λ°Έλ°μ‹±

L7 λ΅λ“ λ°Έλ°μ„λ” μ„μ™€ κ°™μ€ L4 λ΅λ“λ°Έλ°μ„μ κΈ°λ¥μ„ ν¬ν•¨ν•λ” κ²ƒ λΏ λ§ μ•„λ‹λΌ OSI 7κ³„μΈµμ ν”„λ΅ν† μ½(ex. http smtp, ftp λ“±) μ„ λ°”νƒ•μΌλ΅λ„ λ¶„μ‚° μ²λ¦¬κ°€ κ°€λ¥ν•λ‹¤. μλ¥Ό λ“¤μ–΄, μ¨λΌμΈ μ‡Όν•‘λ°μ μ¥λ°”κµ¬λ‹μ— λ¬Όκ±΄λ“¤μ„ λ‹΄μ•„λ†“μ•λ”λ° λ‹¤λ¥Έ μ„λ²„μ—μ„μ μ²λ¦¬λ” μ–΄λ ¤μΈ κ²ƒμ΄λ‹¤. L7 λ΅λ“λ°Έλ°μ‹±μ—λ” λ‹¤μκ³Ό κ°™μ€ λ°©λ²•λ“¤μ΄ μλ‹¤.

- URL μ¤μ„μΉ­ : νΉμ • ν•μ„ URL λ“¤μ€ νΉμ • μ„λ²„λ΅ μ²λ¦¬ν•λ” λ°©μ‹μ΄λ‹¤. μλ¥Όλ“¤μ–΄ β€../abc/image'  λλ” β€../abc/videoβ€™ μ™€ κ°™μ€ νΉμ • URLμ„ κ°€μ§„ μ£Όμ†λ“¤μ€ μ„λ²„κ°€ μ•„λ‹ λ³„λ„μ μ¤ν† λ¦¬μ§€μ— μλ” κ°μ²΄ λ°μ΄ν„°λ΅ λ°”λ΅ μ—°κ²°λλ„λ΅ κµ¬μ„±ν•  μ μλ‹¤.
- μ»¨ν…μ¤νΈ μ¤μ„μΉ­ : ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­ν• νΉμ • λ¦¬μ†μ¤μ— λ€ν•΄ νΉμ • μ„λ²„ λ“±μΌλ΅ μ—°κ²°ν•  μ μλ‹¤. μλ¥Ό λ“¤μ–΄ μ΄λ―Έμ§€ νμΌμ— λ€ν•΄μ„λ” ν™•μ¥μλ¥Ό μ°Έμ΅°ν•μ—¬ λ³„λ„λ΅ κµ¬μ„±λ μ΄λ―Έμ§€ νμΌμ΄ μλ” μ„λ²„/μ¤ν† λ¦¬μ§€λ΅ μ§μ ‘ μ—°κ²°ν•΄μ¤„ μ μλ‹¤.
- μΏ ν‚¤ μ§€μ†μ„± : μΏ ν‚¤ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ ν΄λΌμ΄μ–ΈνΈκ°€ μ—°κ²° ν–μ—λ λ™μΌν• μ„λ²„μ— κ³„μ† ν• λ‹Ήν•΄μ£Όλ” λ°©μ‹μ΄λ‹¤. νΉν μ‚¬μ„¤ λ„¤νΈμ›ν¬μ— μλ ν΄λΌμ΄μ–ΈνΈμ IP μ£Όμ†κ°€ κ³µμΈ IP μ£Όμ†λ΅ μΉν™λμ–΄ μ „μ†΅(X-Forwarded-For ν—¤λ”μ— ν΄λΌμ΄μ–ΈνΈ IP μ£Όμ†λ¥Ό λ³„λ„ κΈ°λ΅) ν•λ” λ°©μ‹μ„ μ§€μ›ν•λ‹¤.
    - `X-Forwarded-For`
        - HTTP λλ” HTTPS λ΅λ“ λ°Έλ°μ„λ¥Ό μ‚¬μ©ν•  λ• ν΄λΌμ΄μ–ΈνΈμ IP μ£Όμ†λ¥Ό μ‹λ³„ν•λ” λ° λ„μ›€μ„ μ¤λ‹λ‹¤.
    - `X-Forwarded-Proto`
        - ν΄λΌμ΄μ–ΈνΈκ°€ λ΅λ“ λ°Έλ°μ„ μ—°κ²°μ— μ‚¬μ©ν• ν”„λ΅ν† μ½(HTTP λλ” HTTPS)μ„ μ‹λ³„ν•λ” λ° λ„μ›€μ„ μ¤λ‹λ‹¤.
    - `X-Forwarded-Port`
        - ν΄λΌμ΄μ–ΈνΈκ°€ λ΅λ“ λ°Έλ°μ„ μ—°κ²°μ— μ‚¬μ©ν• ν¬νΈλ¥Ό μ‹λ³„ν•λ” λ° λ„μ›€μ„ μ¤λ‹λ‹¤.

<img width="707" alt="image" src="https://user-images.githubusercontent.com/61482670/158862920-bce57a77-8101-4af5-8d86-b3b160cdd66b.png">

<BR>

# L4λ°Έλ°μ„μ™€ L7λ°Έλ°μ„ λΉ„κµ

<img width="691" alt="image" src="https://user-images.githubusercontent.com/61482670/158863146-79618c96-f879-4e2e-89ec-b146feabd676.png">

<br>

# μ¶”κ°€λ΅ κ³ λ ¤ν•  μ 

<BR>

π’΅ λ΅λ“λ°Έλ°μ„ λν• μ™„λ²½ν• μ¥λΉ„κ°€ μ•„λ‹λ―€λ΅ μ¥μ• κ°€ λ‚  κ²½μ°λ¥Ό λ€λΉ„ν•μ—¬ λ΅λ“λ°Έλ°μ„ μμ²΄λ„ μ΄μ¤‘ν™” κµ¬μ„±μ„ ν•  ν•„μ”κ°€ μλ‹¤.


<BR>


# Reference

[https://www.stevenjlee.net/2020/06/30/μ΄ν•΄ν•κΈ°-λ„¤νΈμ›ν¬μ-λ¶€ν•λ¶„μ‚°-λ΅λ“λ°Έλ°μ‹±-load-balancing-κ·Έ/](https://www.stevenjlee.net/2020/06/30/%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EB%B6%80%ED%95%98%EB%B6%84%EC%82%B0-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-load-balancing-%EA%B7%B8/)

[https://brunch.co.kr/@sangjinkang/61](https://brunch.co.kr/@sangjinkang/61)

[https://tecoble.techcourse.co.kr/post/2021-11-07-load-balancing/](https://tecoble.techcourse.co.kr/post/2021-11-07-load-balancing/)

[https://nesoy.github.io/articles/2018-06/Load-Balancer](https://nesoy.github.io/articles/2018-06/Load-Balancer)